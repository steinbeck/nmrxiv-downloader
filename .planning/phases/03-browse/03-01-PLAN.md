---
phase: 03-browse
plan: 01
type: execute
---

<objective>
Implement rich metadata display with human-readable table output.

Purpose: Enable both machine-readable JSON (for Claude Code) and human-readable tables (for direct use).
Output: Enhanced `show` command with rich metadata, human-readable output option for all commands.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Available metadata:**
- Projects: name, description, doi, tags, license, download_url, stats, owner
- Datasets: name, type, doi, project, study, has_nmrium, public_url
- Molecules: molecular_formula, molecular_weight, canonical_smiles, iupac_name, synonyms

**Output modes:**
- JSON (default): Machine-readable for Claude Code
- Table (--no-json): Human-readable rich tables using Rich library
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add human-readable table output to output.py</name>
  <files>nmrxiv_downloader/output.py</files>
  <action>
Enhance output.py with rich table support:

1. Add output_table(data, columns, title=None) function:
   - Uses rich.table.Table for formatting
   - Columns is list of (key, header) tuples
   - Truncates long values (max 50 chars)
   - Handles None values gracefully

2. Add output_item(data, title=None) function:
   - Displays single item as key-value pairs
   - Uses rich.panel.Panel for nice formatting
   - Formats dates, URLs, lists nicely

3. Keep output_json() and output_error() unchanged
  </action>
  <verify>python -c "from nmrxiv_downloader.output import output_table; output_table([{'name': 'test'}], [('name', 'Name')])"</verify>
  <done>Rich table output function works</done>
</task>

<task type="auto">
  <name>Task 2: Update list command with table output</name>
  <files>nmrxiv_downloader/cli.py</files>
  <action>
Update list command to support --no-json:

1. When --no-json is passed:
   - For projects: Show name, identifier, doi, created_at
   - For datasets: Show name, type, identifier, doi

2. Add summary footer showing:
   - "Showing X of Y items (page N of M)"

3. Keep JSON as default (--json flag)
  </action>
  <verify>nmrxiv list --type project --no-json</verify>
  <done>List command shows rich table with --no-json</done>
</task>

<task type="auto">
  <name>Task 3: Update search command with table output</name>
  <files>nmrxiv_downloader/cli.py</files>
  <action>
Update search command to support --no-json:

1. For molecule results (--query, --smiles):
   - Show: iupac_name, molecular_formula, molecular_weight, canonical_smiles

2. For dataset results (--type):
   - Show: name, type, identifier, project name

3. Add summary footer showing count and search type
  </action>
  <verify>nmrxiv search --query kaempferol --no-json</verify>
  <done>Search command shows rich table with --no-json</done>
</task>

<task type="auto">
  <name>Task 4: Enhance show command with rich metadata</name>
  <files>nmrxiv_downloader/cli.py</files>
  <action>
Enhance show command for detailed item display:

1. JSON output (default): Keep current behavior

2. Human-readable output (--no-json):
   - Use rich.panel.Panel for item details
   - Group related fields (metadata, links, dates)
   - Format special fields:
     - URLs as clickable links
     - Dates as human-readable
     - Tags as comma-separated list
     - License as title only

3. For datasets, show experiment type prominently

4. For projects, show download_url if available
  </action>
  <verify>nmrxiv show P5 --no-json</verify>
  <done>Show command displays rich formatted metadata</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `nmrxiv list --type project --no-json` shows formatted table
- [ ] `nmrxiv list --type dataset --no-json` shows formatted table
- [ ] `nmrxiv search --query kaempferol --no-json` shows molecule table
- [ ] `nmrxiv search --type hsqc --no-json` shows dataset table
- [ ] `nmrxiv show P5 --no-json` shows rich formatted details
- [ ] `nmrxiv show D410 --no-json` shows dataset details with type
- [ ] JSON output still works as default for all commands
- [ ] All table outputs are properly formatted
</verification>

<success_criteria>

- All tasks completed
- Human-readable tables work with --no-json
- JSON remains default for Claude Code
- Rich metadata displayed in show command
- Tables properly formatted with Rich library
</success_criteria>

<output>
After completion, create `.planning/phases/03-browse/03-01-SUMMARY.md`

Then update:
- .planning/STATE.md
- .planning/ROADMAP.md
</output>
